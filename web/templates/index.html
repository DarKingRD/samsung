<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫</h1>
            <p class="subtitle">–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö, –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∏ —Å–º—ã—Å–ª–æ–≤—ã—Ö –æ—à–∏–±–æ–∫</p>
        </header>

        <main>
            <div class="input-section">
                <label for="text-input">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</label>
                <textarea 
                    id="text-input" 
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–∏–≤–µ—Ç –∫–∞–∫ –¥–µ–ª–∞, –æ–Ω —Å–∫–∞–∑–∞–ª —á—Ç–æ –ø—Ä–∏–¥–µ—Ç..."
                    rows="8"
                ></textarea>
                <div class="button-group">
                    <button id="check-btn" class="btn btn-primary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—Å—Ç</button>
                    <button id="clear-btn" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>

            <div id="results" class="results-section" style="display: none;">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</h2>
                
                <div class="result-item">
                    <h3>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</h3>
                    <div id="corrected-text" class="corrected-text"></div>
                </div>

                <div id="suggestions" class="suggestions-section"></div>

                <div id="errors" class="errors-section"></div>
            </div>

            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç...</p>
            </div>

            <div id="error-message" class="error-message" style="display: none;"></div>
        </main>

        <footer>
            <p>–ò—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∫—É—Ä—Å–∞ Samsung –ø–æ –ò–ò</p>
        </footer>
    </div>

    <script>
        const textInput = document.getElementById('text-input');
        const checkBtn = document.getElementById('check-btn');
        const clearBtn = document.getElementById('clear-btn');
        const results = document.getElementById('results');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const correctedText = document.getElementById('corrected-text');
        const suggestions = document.getElementById('suggestions');
        const errors = document.getElementById('errors');

        checkBtn.addEventListener('click', checkText);
        clearBtn.addEventListener('click', clearAll);

        textInput.addEventListener('input', function() {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        });

        async function checkText() {
            const text = textInput.value.trim();
            
            if (!text) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏');
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loading.style.display = 'block';
            results.style.display = 'none';
            errorMessage.style.display = 'none';

            try {
                const response = await fetch('/api/correct', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–µ–∫—Å—Ç–∞');
                }

                displayResults(data);
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞: ' + error.message);
            } finally {
                loading.style.display = 'none';
            }
        }

        function displayResults(data) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
            correctedText.textContent = data.best_correction;
            correctedText.className = 'corrected-text';
            
            if (data.best_correction !== data.original) {
                correctedText.classList.add('has-changes');
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
            if (data.corrections && data.corrections.length > 1) {
                suggestions.innerHTML = '<h3>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:</h3>';
                const suggestionsList = document.createElement('ul');
                data.corrections.slice(1).forEach((corr, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span class="suggestion-text">${corr.text}</span>
                        <span class="confidence">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(corr.confidence * 100).toFixed(1)}%</span>
                    `;
                    suggestionsList.appendChild(li);
                });
                suggestions.appendChild(suggestionsList);
            } else {
                suggestions.innerHTML = '';
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
            if (data.errors && data.errors.length > 0) {
                errors.innerHTML = '<h3>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:</h3>';
                const errorsList = document.createElement('ul');
                data.errors.forEach((error, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <div class="error-item">
                            <span class="error-text">"${error.original}"</span>
                            <div class="error-suggestions">
                                ${error.suggestions.map(s => `<span class="suggestion-badge">${s}</span>`).join('')}
                            </div>
                            <span class="error-confidence">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(error.confidence * 100).toFixed(1)}%</span>
                        </div>
                    `;
                    errorsList.appendChild(li);
                });
                errors.appendChild(errorsList);
            } else {
                errors.innerHTML = '<p class="no-errors">‚úÖ –û—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!</p>';
            }

            results.style.display = 'block';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            results.style.display = 'none';
        }

        function clearAll() {
            textInput.value = '';
            results.style.display = 'none';
            errorMessage.style.display = 'none';
            correctedText.textContent = '';
            suggestions.innerHTML = '';
            errors.innerHTML = '';
        }
    </script>
</body>
</html>
